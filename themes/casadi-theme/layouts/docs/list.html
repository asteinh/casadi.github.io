{{ partial "header" . }}
{{ partial "nav-top" . }}

<div id="main" class="docs container">
  <div class="row flex-nowrap">
    {{ partial "nav-side" . }}
    <div class="content d-flex">
      <div class="col p-4">
        <h1>{{ .Title }}</h1>
        {{ if eq .Params.layout "page" }}
          <span class="reading-time">{{ partial "reading-time" . }}</span>
          {{ .Content }}
        {{ else }}
          {{ $.Scratch.Set "topURL" .Permalink }}
          {{ $rootNode := . }}
          {{ range .Site.Menus.docs.ByWeight }}
            {{ $.Scratch.Set "currentMenuEntry" . }}
            {{ template "recursive-nodes" $rootNode }}
          {{ end }}
        {{ end }}
      </div>
    </div>
  </div>
</div>

{{ partial "footer" . }}

{{ define "recursive-nodes" }}
  {{ $rootNode := . }}
  {{ $currentMenuEntry := .Scratch.Get "currentMenuEntry" }}

  {{ if (hasPrefix (absURL $currentMenuEntry.URL) (.Scratch.Get "topURL")) }}
    {{ if $currentMenuEntry.HasChildren }}
      <!-- concat this content -->
      {{ range $currentMenuEntry.Children }}
        <!-- <p>{{ . }}</p> -->
        {{ $.Scratch.Set "currentMenuEntry" . }}
        {{ template "recursive-nodes" $rootNode }}
      {{ end }}
    {{ else }}
      {{ $currentMenuEntry.Page.Render "single" }}
    {{ end }}
  {{ end }}
{{ end }}
