{{ $currentNode := . }}

<nav class="nav-side">
  <span class="header">
    {{ .Site.Params.DocsHeader }}
  </span>
  <ul class="entries">
    {{ range .Site.Menus.docs.ByWeight }}
      {{ $.Scratch.Set "currentMenuEntry" . }}
      {{ template "nav-side-entry" $currentNode }}
    {{ end }}
  </ul>
</nav>

{{ define "nav-side-entry" }}
  {{ $currentNode := . }}
  {{ $currentMenuEntry := .Scratch.Get "currentMenuEntry" }}
  {{ $isCurrent := eq .Permalink ($currentMenuEntry.URL | absURL | printf "%s") }}
  {{ $isActive := hasPrefix .Permalink (absURL $currentMenuEntry.URL) }}

  {{ if $currentMenuEntry.HasChildren }}
    <li class="fold-out {{ if $isActive }}active{{ end }}">
      <a href="#{{ $currentMenuEntry.Name | urlize }}" {{ if not $isActive }}class="collapsed"{{ end }} data-target="#{{ $currentMenuEntry.Name | urlize }}" data-toggle="collapse" aria-expanded="false" aria-controls="{{ $currentMenuEntry.Name | urlize }}">
        {{ $currentMenuEntry.Name }}</a>
      <a href="{{ $currentMenuEntry.URL }}" title="Show on single page"><i class="fa fa-clone"></i></a>
      <i class="fa fa-caret-down"></i>
    </li>
    <div class="collapse{{ if $isActive }} show{{ end }}" id="{{ $currentMenuEntry.Name | urlize }}">
      <ul>
        {{ range $currentMenuEntry.Children }}
          {{ $.Scratch.Set "currentMenuEntry" . }}
          {{ template "nav-side-entry" $currentNode }}
        {{ end }}
      </ul>
    </div>
  {{ else }}
    <li class="{{ if $isActive }}active {{ end }}{{ if $isCurrent }}current{{ end }}">
      <a href="{{ $currentMenuEntry.URL }}">{{ $currentMenuEntry.Name }}</a>
      {{ if $isCurrent }}
        <ul id="scrollspy"></ul>
      {{ end }}
    </li>

  {{ end }}
{{ end }}
