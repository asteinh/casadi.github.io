{{ $currentNode := . }}
{{ $currentMenuEntry := .Scratch.Get "currentMenuEntry" }}
{{ $isCurrent := eq .Permalink ($currentMenuEntry.URL | absURL | printf "%s") }}
{{ $isActive := hasPrefix .Permalink (absURL $currentMenuEntry.URL) }}

{{ if $currentMenuEntry.HasChildren }}
  <li class="fold-out {{ if $isActive }}active{{ end }}">
    <a href="#{{ $currentMenuEntry.Name | urlize }}" {{ if not $isActive }}class="collapsed"{{ end }} data-target="#{{ $currentMenuEntry.Name | urlize }}" data-toggle="collapse" aria-expanded="false" aria-controls="{{ $currentMenuEntry.Name | urlize }}">
      {{ $currentMenuEntry.Name }}<i class="fa fa-caret-down"></i>
    </a>
  </li>
  <div class="collapse{{ if $isActive }} show{{ end }}" id="{{ $currentMenuEntry.Name | urlize }}">
    <ul>
      {{ range $currentMenuEntry.Children }}
        {{ $.Scratch.Set "currentMenuEntry" . }}
        {{ partial "nav-side-recursive" $currentNode }}
      {{ end }}
    </ul>
  </div>
{{ else }}
  <li class="{{ if $isActive }}active {{ end }}{{ if $isCurrent }}current{{ end }}">
    <a href="{{ $currentMenuEntry.URL }}">{{ $currentMenuEntry.Name }}</a>
    {{ if $isCurrent }}
      <ul id="scrollspy"></ul>
    {{ end }}
  </li>

{{ end }}
